# Smart Money Concepts (SMC) Signal Service

Комплексний сервіс торгових сигналів, який генерує сигнали Smart Money Concepts (SMC) в реальному часі та історичні дані з локальним зберіганням, можливостями бектестування та сучасним веб-інтерфейсом.

## 🆕 Останні оновлення (v0.1.0)

### ✅ **Виправлено проблеми з імпортом**
- **Залежності Docker**: Вирішено проблему з відсутнім пакетом `pydantic`
- **Менеджер кешу**: Виправлено помилку імпорту `CacheManager` в модулі зберігання
- **Торговий стан**: Додано відсутню властивість `execution_enabled`
- **Ланцюжок імпорту**: Всі залежності імпорту тепер працюють коректно

### 🚀 **Режим перегляду реалізовано**
- **Mock Binance клієнт**: Генерує реалістичні тестові дані без API ключів
- **Mock SMC двигун**: Симулює генерацію SMC сигналів для тестування
- **Mock двигун бектестингу**: Забезпечує функціональність бектестингу без живих даних
- **API ключі не потрібні**: Система запускається одразу після налаштування

### 🔧 **Поточний статус**
- **API контейнер**: ✅ Працює на порту 8000
- **Worker контейнер**: ✅ Працює на порту 8001
- **Mock дані**: ✅ Генеруються кожні 30 секунд
- **Веб-інтерфейс**: ✅ Повністю функціональний
- **Помилки імпорту**: ✅ Всі вирішені

## 🚀 Можливості

- **Дані в реальному часі**: Інтеграція WebSocket з Binance для живих ринкових даних
- **SMC сигнали**: Break of Structure (BOS), Change of Character (CHOCH), Fair Value Gaps (FVG), Sweeps
- **Підтримка багатьох часових кадрів**: 1m, 5m, 15m, 30m, 1h, 4h, 1d
- **Локальне зберігання**: Ефективне зберігання даних на основі Parquet з кешуванням в пам'яті
- **Двигун бектестингу**: Історичне тестування стратегій з комплексними метриками
- **CSV звіти**: Детальний аналіз торгівлі з експортом
- **Сканер волатильності**: Ранжування та аналіз ринкової волатильності
- **Сучасний веб-інтерфейс**: Адаптивна панель з HTMX для динамічних оновлень
- **REST API**: Повнофункціональний API для інтеграції та автоматизації
- **Підтримка Docker**: Легке розгортання з docker-compose

## 🏗️ Архітектура

### 🎭 **Режим перегляду (За замовчуванням)**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Mock Binance   │    │  Mock WebSocket │    │   FastAPI App   │
│   (Симуляція)   │    │   (Тестові дані)│    │   (Веб + API)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │  Parquet Storage│
                    │  + In-Memory    │
                    │     Cache       │
                    └─────────────────┘
```

### 🔑 **Режим живої торгівлі (З API ключами)**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Binance API   │    │  WebSocket WS   │    │   FastAPI App   │
│   (Історичні)   │    │   (Реальний час)│    │   (Веб + API)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │  Parquet Storage│
                    │  + In-Memory    │
                    │     Cache       │
                    └─────────────────┘
```

## 📋 Вимоги

- Python 3.11+
- Docker & Docker Compose
- Binance API облікові дані (для живих даних) - **необов'язково для режиму перегляду**

## 🚀 Швидкий старт

### 🎯 **Режим перегляду (Рекомендується для тестування)**

Система тепер працює в **режимі перегляду** за замовчуванням, генеруючи реалістичні mock дані без необхідності API ключів Binance:

```bash
# Клонування та налаштування
git clone <repository-url>
cd smart-trading-bot

# Запуск сервісів одразу (налаштування не потрібне)
docker compose up --build
```

**Що ви отримуєте:**
- ✅ **Mock ринкові дані** для BTCUSDT, ETHUSDT, BNBUSDT
- ✅ **SMC сигнали** генеруються кожні 30 секунд
- ✅ **Повний бектестинг** з симульованими даними
- ✅ **Веб-панель** повністю функціональна
- ✅ **API ендпоінти** працюють без аутентифікації

### 🔑 **Режим живої торгівлі (Опціонально)**

Для живої торгівлі з реальними даними налаштуйте ваші API облікові дані Binance:

### 1. Клонування та налаштування

```bash
git clone <repository-url>
cd smart-trading-bot
cp env.example .env
```

### 2. Налаштування середовища

Відредагуйте файл `.env` з вашими API обліковими даними Binance:

```bash
# Налаштування API Binance
BINANCE_API_KEY=ваш_api_ключ_тут
BINANCE_SECRET_KEY=ваш_секретний_ключ_тут
BINANCE_TESTNET=false

# Безпека
SHARED_SECRET=ваш_спільний_секрет_тут
```

### 3. Запуск сервісів

```bash
# Запуск обох API та WebSocket worker
docker compose up --build

# Або запуск сервісів окремо
docker compose up api      # FastAPI сервіс на порту 8000
docker compose up worker   # WebSocket worker на порту 8001
```

### 4. Перевірка встановлення

- **API Health**: http://localhost:8000/health
- **Веб-панель**: http://localhost:8000/web/
- **API документація**: http://localhost:8000/docs
- **Інтерфейс бектестингу**: http://localhost:8000/web/backtest

## 📊 Джерела даних

### 🎭 **Mock дані (Режим перегляду)**
- **Реалістична симуляція**: Генерує OHLCV дані схожі на реальні ринкові умови
- **Частота оновлення**: Нові свічки кожні 30 секунд
- **Підтримувані пари**: BTCUSDT, ETHUSDT, BNBUSDT
- **Часові кадри**: 1m, 5m, 15m (налаштовується)
- **API ключі не потрібні**: Працює одразу після запуску

### 📈 **Історичні дані (Живий режим)**
- **Binance REST API**: Історичні дані kline для заповнення
- **Часові кадри**: 1m, 5m, 15m, 30m, 1h, 4h, 1d
- **Зберігання**: Локальні файли Parquet в директорії `./data/`

### ⚡ **Дані в реальному часі (Живий режим)**
- **Binance WebSocket**: Живий потік kline
- **Підтримувані пари**: BTCUSDT, ETHUSDT, BNBUSDT (налаштовується)
- **Частота оновлення**: Реальний час при закритті свічок

## 🔧 API ендпоінти

### Основні ендпоінти
- `GET /health` - Перевірка здоров'я сервісу
- `GET /api/v1/pairs/` - Доступні торгові пари
- `GET /api/v1/candles/` - Історичні дані свічок
- `GET /api/v1/signals/` - SMC торгові сигнали

### Розширені можливості
- `GET /api/v1/backtest/` - Запуск бектестингу стратегій
- `GET /api/v1/scan/volatility` - Аналіз волатильності
- `GET /api/v1/signals/stats/summary` - Статистика сигналів

### Приклад використання API

```bash
# Отримання останніх свічок для BTCUSDT 15m
curl "http://localhost:8000/api/v1/candles/?symbol=BTCUSDT&timeframe=15m&limit=100"

# Запуск бектестингу для ETHUSDT 1h
curl "http://localhost:8000/api/v1/backtest/?symbol=ETHUSDT&tf=1h&from_date=2024-01-01&to_date=2024-01-31"

# Отримання рейтингу волатильності
curl "http://localhost:8000/api/v1/scan/volatility?tf=15m&top=20"
```

## 🧪 Бектестинг

### Можливості
- **Симуляція стратегії**: Стратегія пробою з налаштовуваними параметрами
- **Управління ризиками**: Автоматизація stop-loss та take-profit
- **Метрики продуктивності**: Відсоток виграшів, фактор прибутку, R-множник, просадка
- **CSV експорт**: Детальний аналіз торгівлі по торгівлі

### Розраховані метрики
- Загальна кількість торгів, відсоток виграшів, фактор прибутку
- Середній R-множник, очікуваність
- Максимальна просадка, подібний до Sharpe коефіцієнт
- Час на ринку, аналіз MAE/MFE

## 📈 Веб-інтерфейс

### Панель
- Моніторинг сигналів в реальному часі
- Огляд ринку та статистика
- Сканер волатильності з вибором часового кадру
- Доступні пари та часові кадри

### Інтерфейс бектестингу
- Налаштування параметрів стратегії
- Інтерактивне відображення результатів
- Візуалізація метрик продуктивності
- Завантаження CSV звіту

## 🗄️ Зберігання даних

### Структура
```
data/
├── candles/          # OHLCV дані за символом/часовим кадром
├── signals/          # SMC сигнали за символом/часовим кадром
└── backtests/        # Результати бектестингу

reports/              # CSV експорти
├── {symbol}/
└── {timeframe}/
```

### Формат зберігання
- **Parquet**: Ефективне колонкове зберігання для часових рядів
- **Стиснення**: Snappy стиснення для оптимального розміру/продуктивності
- **Розбиття**: Організовано за символом та часовим кадром
- **Кешування**: Кеш в пам'яті LRU з TTL

## 🔌 Налаштування

### Змінні середовища
```bash
# Налаштування даних
DATA_DIR=./data
REPORTS_DIR=./reports
CACHE_TTL=300

# Налаштування WebSocket
WS_RECONNECT_DELAY=5
WS_MAX_RECONNECT_ATTEMPTS=10

# Налаштування API
API_HOST=0.0.0.0
API_PORT=8000
WORKER_HOST=0.0.0.0
WORKER_PORT=8001

# Індикатори
INDICATORS=BOS,CHOCH,FVG,SWEEP
TIMEFRAMES=1m,5m,15m,30m,1h,4h,1d
```

### Налаштування
- **Символи**: Модифікуйте `WebSocketWorker.symbols` в `app/workers/websocket_worker.py`
- **Часові кадри**: Оновіть `TIMEFRAMES` в `.env`
- **Індикатори**: Налаштуйте `INDICATORS` в `.env`

## 🚀 Розробка

### Локальне налаштування розробки

```bash
# Створення віртуального середовища
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate

# Встановлення залежностей
pip install -r requirements.txt

# Встановлення залежностей для розробки
pip install -r requirements.txt[dev]

# Запуск сервісів
python -m app.main          # API сервіс
python -m app.workers.websocket_worker  # WebSocket worker
```

### Якість коду
```bash
# Форматування
black app/
ruff check app/

# Перевірка типів
mypy app/

# Тестування
pytest tests/
```

### Структура проекту
```
smart-trading-bot/
├── app/
│   ├── api/              # REST API ендпоінти
│   ├── models/           # Pydantic моделі даних
│   ├── services/         # Бізнес-логіка
│   │   ├── binance_client.py    # Mock Binance клієнт (режим перегляду)
│   │   ├── smc_engine.py        # Mock SMC двигун сигналів
│   │   └── backtest_engine.py   # Mock двигун бектестингу
│   ├── storage/          # Збереження даних
│   ├── web/              # Веб-інтерфейс
│   └── workers/          # Фонові роботи
├── data/                 # Зберігання Parquet
├── reports/              # CSV експорти
├── tests/                # Набір тестів
├── docker-compose.yml    # Docker налаштування
└── requirements.txt      # Python залежності
```

## 🔒 Безпека

### Безпека API
- **Обмеження швидкості**: Налаштовувані ліміти запитів
- **Спільний секрет**: Валідація заголовка X-Shared-Secret
- **CORS**: Налаштовувані політики cross-origin

### Безпека даних
- **Локальне зберігання**: Немає залежностей від зовнішніх баз даних
- **API ключі**: Безпечне зберігання змінних середовища
- **Контроль доступу**: Система дозволів готова до майбутнього

## 📊 Моніторинг

### Перевірка здоров'я
- **Здоров'я сервісу**: ендпоінт `/health`
- **Статус кешу**: Вбудований моніторинг кешу
- **Статус зберігання**: Перевірка цілісності файлів Parquet

### Логування
- **Структуроване логування**: JSON-подібний формат
- **Рівні логування**: Налаштовувана деталізація
- **Відстеження помилок**: Комплексна обробка помилок

## 🚧 Майбутні покращення

### Заплановані можливості
- **SMC індикатори**: Розширене виявлення BOS/CHOCH/FVG
- **Двигун виконання**: Управління та виконання ордерів
- **Управління ризиками**: Розмір позиції та управління портфелем
- **Машинне навчання**: Прогнозування сигналів та оптимізація
- **Багато бірж**: Підтримка додаткових бірж

### Фундамент виконання
- **Управління ордерами**: Відстеження життєвого циклу ордерів
- **Відстеження позицій**: Моніторинг P&L в реальному часі
- **Контроль ризиків**: Максимальні ліміти позицій
- **Аудит логування**: Повна історія торгів

## 🤝 Внесок

1. Форк репозиторію
2. Створення гілки функції
3. Внесення змін
4. Додавання тестів для нової функціональності
5. Забезпечення якості коду (black, ruff, mypy)
6. Подання pull request

## 📄 Ліцензія

Цей проект ліцензовано під MIT License - дивіться файл LICENSE для деталей.

## ⚠️ Відмова від відповідальності

Це програмне забезпечення призначено тільки для освітніх та дослідницьких цілей. Це не фінансова порада. Торгівля криптовалютами пов'язана з суттєвим ризиком та може призвести до втрати вашого інвестованого капіталу. Завжди проводите власне дослідження та розгляньте можливість консультації з фінансовим радником перед прийняттям інвестиційних рішень.

## 🆘 Підтримка

### 🐛 **Вирішення проблем**

#### **Помилки імпорту (Виправлено)**
Якщо ви зіткнетеся з помилками імпорту, вони вирішені в v0.1.0:

```bash
# ✅ Виправлено: Відсутня залежність pydantic
# Рішення: Docker образ тепер включає всі необхідні пакети

# ✅ Виправлено: Помилка імпорту CacheManager
# Рішення: Додано псевдонім CacheManager в cache_manager.py

# ✅ Виправлено: Помилка атрибуту execution_enabled
# Рішення: Додано відсутню властивість в класі TradingState
```

#### **Поширені проблеми**
- **Порт вже використовується**: Змініть порти в `docker-compose.yml`
- **Відмовлено в дозволі**: Переконайтеся, що Docker має належні дозволи
- **Контейнер не запускається**: Перевірте логи з `docker-compose logs`

### **Проблеми**: GitHub Issues для звітів про помилки та запитів функцій

---

**Створено з ❤️ для торгової спільноти**
